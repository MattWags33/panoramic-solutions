{
  "schema_version": "1.0.0",
  "last_updated": "2025-11-10T18:00:00Z",
  "type": "ARCHITECTURE",
  "metadata": {
    "project": "Panoramic Solutions - PPM Tool",
    "maintainer": "Parker Gawne",
    "mcp_compatible": true,
    "description": "Complete data flow architecture from user interaction to analytics dashboards"
  },
  "overview": {
    "description": "This document describes how data flows from user actions in the PPM Tool through dual tracking systems (PostHog + Supabase) to executive dashboards",
    "systems_involved": ["React Frontend", "PostHog", "Supabase Analytics DB", "PostHog Data Warehouse"],
    "key_principle": "Dual tracking ensures accuracy and completeness"
  },
  "data_flow_diagram": {
    "ascii_diagram": "\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                         USER INTERACTION                                 â”‚\nâ”‚  (Visitor lands â†’ Engages â†’ Answers questions â†’ Clicks tools â†’ Sends)  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                             â”‚\n                             â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                      REACT FRONTEND (src/)                               â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Components track events via:                                     â”‚  â”‚\nâ”‚  â”‚  - src/lib/analytics.ts (Supabase RPC calls)                     â”‚  â”‚\nâ”‚  â”‚  - src/lib/posthog.ts (PostHog capture events)                   â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                                 â”‚\n                â”‚ Supabase RPC                    â”‚ PostHog Events\n                â”‚ Functions                       â”‚ (capture API)\n                â–¼                                 â–¼\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   SUPABASE ANALYTICS DB       â”‚   â”‚        POSTHOG EVENTS            â”‚\nâ”‚   (PostgreSQL)                â”‚   â”‚                                   â”‚\nâ”‚                               â”‚   â”‚  Events Tracked:                  â”‚\nâ”‚  Tables:                      â”‚   â”‚  - New_Visitor                    â”‚\nâ”‚  â”œâ”€ users                     â”‚   â”‚  - New_Active                     â”‚\nâ”‚  â”œâ”€ user_question_responses   â”‚   â”‚  - New_Partial_Ranking            â”‚\nâ”‚  â”œâ”€ user_criteria_responses   â”‚   â”‚  - New_Full_Ranking_Submittal     â”‚\nâ”‚  â”œâ”€ user_tool_actions         â”‚   â”‚  - New_Report_Sent                â”‚\nâ”‚  â”œâ”€ recommendations           â”‚   â”‚  - Tool_Try_Free_Click            â”‚\nâ”‚  â”œâ”€ questions                 â”‚   â”‚  - Tool_Add_To_Compare_Click      â”‚\nâ”‚  â””â”€ question_choices          â”‚   â”‚  - Tool_View_Details_Click        â”‚\nâ”‚                               â”‚   â”‚                                   â”‚\nâ”‚  RPC Functions:               â”‚   â”‚  Properties:                      â”‚\nâ”‚  â”œâ”€ ensure_analytics_user()   â”‚   â”‚  - session_id (distinct_id)       â”‚\nâ”‚  â”œâ”€ track_question_response() â”‚   â”‚  - tool_id, tool_name             â”‚\nâ”‚  â”œâ”€ track_criteria_response() â”‚   â”‚  - match_score, position          â”‚\nâ”‚  â”œâ”€ track_tool_action()       â”‚   â”‚  - $initial_utm_source            â”‚\nâ”‚  â””â”€ track_recommendation_sent()â”‚   â”‚  - $initial_utm_campaign          â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                â”‚                               â”‚\n                â”‚ Data Warehouse Sync           â”‚ Native PostHog Data\n                â”‚ (Hourly via PostgreSQL)       â”‚\n                â”‚                               â”‚\n                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                â”‚\n                                â–¼\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚         POSTHOG DATA WAREHOUSE                   â”‚\n         â”‚                                                  â”‚\n         â”‚  Imported Supabase Tables:                       â”‚\n         â”‚  â”œâ”€ analytics_users                              â”‚\n         â”‚  â”œâ”€ analytics_user_question_responses            â”‚\n         â”‚  â”œâ”€ analytics_user_criteria_responses            â”‚\n         â”‚  â”œâ”€ analytics_user_tool_actions                  â”‚\n         â”‚  â”œâ”€ analytics_recommendations                    â”‚\n         â”‚  â”œâ”€ analytics_questions                          â”‚\n         â”‚  â””â”€ analytics_question_choices                   â”‚\n         â”‚                                                  â”‚\n         â”‚  Can JOIN with PostHog events on:                â”‚\n         â”‚  events.distinct_id = analytics_users.session_id â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                â”‚\n                                â–¼\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚        POSTHOG SQL INSIGHTS & DASHBOARDS         â”‚\n         â”‚                                                  â”‚\n         â”‚  Combined Queries Example:                       â”‚\n         â”‚  SELECT                                          â”‚\n         â”‚    e.event,                                      â”‚\n         â”‚    u.initial_utm_source,                         â”‚\n         â”‚    t.match_score,                                â”‚\n         â”‚    COUNT(*) as count                             â”‚\n         â”‚  FROM events e                                   â”‚\n         â”‚  JOIN analytics_users u                          â”‚\n         â”‚    ON e.distinct_id = u.session_id               â”‚\n         â”‚  JOIN analytics_user_tool_actions t              â”‚\n         â”‚    ON u.user_id = t.user_id                      â”‚\n         â”‚  WHERE e.event = 'Tool_Try_Free_Click'           â”‚\n         â”‚  GROUP BY e.event, u.initial_utm_source,         â”‚\n         â”‚           t.match_score                          â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                â”‚\n                                â–¼\n         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚      EXECUTIVE DASHBOARDS (PostHog UI)           â”‚\n         â”‚                                                  â”‚\n         â”‚  ðŸ“Š PPM Tool - Executive Metrics                 â”‚\n         â”‚  ðŸŽ¯ User Journey & Conversion                    â”‚\n         â”‚  ðŸ› ï¸  Tool Performance & Monetization             â”‚\n         â”‚  ðŸ’° Attribution & Marketing ROI                  â”‚\n         â”‚  âš¡ Real-Time Activity Monitor                   â”‚\n         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n",
    "key_connections": [
      {
        "connection": "Frontend â†’ Supabase",
        "mechanism": "RPC function calls via @supabase/supabase-js client",
        "data_sent": "User actions, session context, personalization choices",
        "response": "Success/error status, generated IDs (user_id, recommendation_id)"
      },
      {
        "connection": "Frontend â†’ PostHog",
        "mechanism": "posthog.capture() via posthog-js library",
        "data_sent": "Event names, properties (tool_id, match_score, etc.)",
        "response": "Async - fire and forget"
      },
      {
        "connection": "Supabase â†’ PostHog Data Warehouse",
        "mechanism": "PostgreSQL connection (read-only)",
        "sync_frequency": "Hourly (configurable)",
        "sync_type": "Incremental (for large tables) + Full Refresh (for reference tables)"
      },
      {
        "connection": "PostHog Events + Data Warehouse â†’ Dashboards",
        "mechanism": "SQL queries in PostHog UI",
        "join_key": "events.distinct_id = analytics_users.session_id",
        "query_language": "PostgreSQL-compatible SQL"
      }
    ]
  },
  "event_tracking_detail": {
    "description": "Every user action triggers tracking to BOTH systems simultaneously",
    "example_flow": {
      "user_action": "User clicks Try Free button on a tool",
      "frontend_code": "src/ppm-tool/components/cards/EnhancedCompactToolCard.tsx",
      "simultaneous_tracking": [
        {
          "system": "PostHog",
          "function_called": "trackToolTryFreeClick()",
          "event_name": "Tool_Try_Free_Click",
          "properties": {
            "tool_id": "Monday.com",
            "tool_name": "Monday",
            "position": 1,
            "match_score": 87.5,
            "$initial_utm_source": "google",
            "$initial_utm_campaign": "ppm-tool-search"
          }
        },
        {
          "system": "Supabase",
          "function_called": "analytics.trackToolClick()",
          "rpc_function": "track_tool_action()",
          "database_insert": "analytics.user_tool_actions",
          "data_stored": {
            "user_id": "uuid-from-users-table",
            "tool_id": "Monday.com",
            "tool_name": "Monday",
            "action_type": "try_free",
            "position": 1,
            "match_score": 87.5,
            "context": "criteria_adjusted",
            "created_at": "2025-11-10T18:00:00Z"
          }
        }
      ],
      "result": "Both systems have the data - PostHog for dashboards, Supabase for detailed queries"
    }
  },
  "data_warehouse_sync_detail": {
    "sync_configuration": {
      "connection_type": "PostgreSQL (native Supabase support)",
      "host": "db.ikqxrzhtdymkjmgxejxu.supabase.co",
      "port": 5432,
      "database": "postgres",
      "schema": "analytics",
      "ssl_mode": "require",
      "sync_frequency": "Every 1 hour",
      "sync_method": "Incremental (change data capture)"
    },
    "incremental_sync_tables": [
      {
        "table": "analytics.users",
        "sync_key": "updated_at",
        "how_it_works": "Only syncs rows where updated_at > last_sync_timestamp",
        "efficiency": "Very efficient - only new/updated users"
      },
      {
        "table": "analytics.user_question_responses",
        "sync_key": "answered_at",
        "how_it_works": "Only syncs rows where answered_at > last_sync_timestamp",
        "efficiency": "Very efficient - only new responses"
      },
      {
        "table": "analytics.user_criteria_responses",
        "sync_key": "created_at",
        "how_it_works": "Only syncs rows where created_at > last_sync_timestamp",
        "efficiency": "Very efficient - only new criteria ratings"
      },
      {
        "table": "analytics.user_tool_actions",
        "sync_key": "created_at",
        "how_it_works": "Only syncs rows where created_at > last_sync_timestamp",
        "efficiency": "Very efficient - only new tool clicks"
      },
      {
        "table": "analytics.recommendations",
        "sync_key": "created_at",
        "how_it_works": "Only syncs rows where created_at > last_sync_timestamp",
        "efficiency": "Very efficient - only new reports sent"
      }
    ],
    "full_refresh_tables": [
      {
        "table": "analytics.questions",
        "why_full_refresh": "Small reference table (~10 rows), rarely changes",
        "efficiency": "Negligible overhead"
      },
      {
        "table": "analytics.question_choices",
        "why_full_refresh": "Small reference table (~50 rows), rarely changes",
        "efficiency": "Negligible overhead"
      }
    ],
    "data_freshness": "PostHog dashboards show data within 1 hour of database changes"
  },
  "combined_analytics_power": {
    "description": "With both systems connected, you get the best of both worlds",
    "posthog_strengths": [
      "Real-time event tracking (< 1 second latency)",
      "Pre-built dashboard visualizations",
      "Funnel analysis",
      "Session replay (if enabled)",
      "A/B testing (if enabled)",
      "Cohort analysis",
      "Traffic attribution ($initial_utm_* properties)",
      "User-friendly UI"
    ],
    "supabase_strengths": [
      "Detailed user-level data (full session context)",
      "Tool action context (match_score, position, etc.)",
      "Guided ranking answers (full questionnaire data)",
      "Personalization choices (departments, methodologies)",
      "Relational data structure (easy JOINs)",
      "Data persistence across devices",
      "ACID compliance",
      "Backup and point-in-time recovery"
    ],
    "combined_power": [
      "PostHog dashboards can query Supabase data via SQL insights",
      "Events can be joined with user sessions for full context",
      "Executive metrics (PostHog) + operational details (Supabase)",
      "Single source of truth with hourly sync",
      "No manual data exports or ETL pipelines needed",
      "Query performance optimized by both systems"
    ]
  },
  "example_combined_queries": [
    {
      "query_name": "Tool Performance by Match Score Bucket",
      "business_question": "Do higher match scores lead to more Try Free clicks?",
      "sql": "SELECT CASE WHEN match_score >= 80 THEN '80-100%' WHEN match_score >= 60 THEN '60-79%' WHEN match_score >= 40 THEN '40-59%' ELSE '<40%' END as score_bucket, action_type, COUNT(*) as actions FROM analytics_user_tool_actions WHERE action_type = 'try_free' GROUP BY score_bucket, action_type ORDER BY score_bucket DESC",
      "insight_type": "Bar Chart",
      "data_source": "Supabase (via Data Warehouse)",
      "value": "Reveals if recommendation algorithm is accurate"
    },
    {
      "query_name": "Conversion Funnel Segmented by UTM Source",
      "business_question": "Which marketing channels bring users who complete the full funnel?",
      "sql": "SELECT u.initial_utm_source, COUNT(DISTINCT CASE WHEN e.event = 'New_Visitor' THEN e.distinct_id END) as visitors, COUNT(DISTINCT CASE WHEN e.event = 'New_Active' THEN e.distinct_id END) as active, COUNT(DISTINCT CASE WHEN e.event = 'New_Report_Sent' THEN e.distinct_id END) as converted, ROUND(100.0 * COUNT(DISTINCT CASE WHEN e.event = 'New_Report_Sent' THEN e.distinct_id END) / NULLIF(COUNT(DISTINCT CASE WHEN e.event = 'New_Visitor' THEN e.distinct_id END), 0), 2) as conversion_rate FROM events e JOIN analytics_users u ON e.distinct_id = u.session_id WHERE e.timestamp > NOW() - INTERVAL '30 days' GROUP BY u.initial_utm_source ORDER BY converted DESC",
      "insight_type": "Table",
      "data_source": "PostHog Events + Supabase Users",
      "value": "ROI by marketing channel"
    },
    {
      "query_name": "Time to Conversion by Engagement Level",
      "business_question": "Do users who click more tools convert faster?",
      "sql": "WITH user_engagement AS (SELECT user_id, COUNT(*) as tool_clicks FROM analytics_user_tool_actions GROUP BY user_id), conversions AS (SELECT u.user_id, r.created_at as converted_at, u.first_seen_at, ue.tool_clicks FROM analytics_users u JOIN analytics_recommendations r ON u.user_id = r.user_id JOIN user_engagement ue ON u.user_id = ue.user_id) SELECT CASE WHEN tool_clicks <= 2 THEN 'Low (â‰¤2)' WHEN tool_clicks <= 5 THEN 'Medium (3-5)' ELSE 'High (6+)' END as engagement_level, COUNT(*) as conversions, ROUND(AVG(EXTRACT(EPOCH FROM (converted_at - first_seen_at)) / 3600), 2) as avg_hours_to_convert FROM conversions GROUP BY engagement_level ORDER BY avg_hours_to_convert",
      "insight_type": "Table",
      "data_source": "Supabase (joined across multiple tables)",
      "value": "Optimize UX - encourage engagement?"
    },
    {
      "query_name": "Question Abandonment Rate by Question",
      "business_question": "Which guided ranking questions cause users to drop off?",
      "sql": "WITH question_reach AS (SELECT question_id, question_order, COUNT(DISTINCT user_id) as users_answered FROM analytics_user_question_responses GROUP BY question_id, question_order), previous_question AS (SELECT qr.question_order, COUNT(DISTINCT qr2.user_id) as users_started FROM analytics_user_question_responses qr JOIN analytics_user_question_responses qr2 ON qr2.question_order < qr.question_order GROUP BY qr.question_order) SELECT q.question_text, qr.question_order, qr.users_answered, COALESCE(pq.users_started, (SELECT COUNT(DISTINCT user_id) FROM analytics_users)) as users_reached, ROUND(100.0 * qr.users_answered / NULLIF(COALESCE(pq.users_started, (SELECT COUNT(DISTINCT user_id) FROM analytics_users)), 0), 2) as completion_rate FROM question_reach qr JOIN analytics_questions q ON qr.question_id = q.question_id LEFT JOIN previous_question pq ON qr.question_order = pq.question_order ORDER BY qr.question_order",
      "insight_type": "Table",
      "data_source": "Supabase (questions + responses)",
      "value": "Identify problematic questions, improve questionnaire"
    }
  ],
  "data_accuracy_guarantees": {
    "session_id_consistency": {
      "description": "Same session_id used in both systems",
      "posthog": "Set as distinct_id via posthog.identify(session_id)",
      "supabase": "Stored in analytics.users.session_id",
      "join_condition": "events.distinct_id = analytics_users.session_id",
      "why_important": "Enables joining PostHog events with Supabase user context"
    },
    "event_timestamp_consistency": {
      "description": "Both systems capture timestamps at event time",
      "posthog": "events.timestamp (automatically set by PostHog)",
      "supabase": "created_at / updated_at (set by database DEFAULT NOW())",
      "typical_difference": "< 1 second (network latency)",
      "why_acceptable": "Analytics are at hourly/daily granularity"
    },
    "data_validation": {
      "recommended_checks": [
        {
          "check": "Event count parity",
          "frequency": "Weekly",
          "query_posthog": "SELECT COUNT(*) FROM events WHERE event = 'New_Report_Sent' AND timestamp > '2025-11-01'",
          "query_supabase": "SELECT COUNT(*) FROM analytics.recommendations WHERE created_at > '2025-11-01'",
          "expected": "Counts match (Â±1 for timing)"
        },
        {
          "check": "Unique user counts",
          "frequency": "Weekly",
          "query_posthog": "SELECT COUNT(DISTINCT distinct_id) FROM events WHERE event = 'New_Visitor'",
          "query_supabase": "SELECT COUNT(*) FROM analytics.users",
          "expected": "Supabase â‰¥ PostHog (includes historical)"
        },
        {
          "check": "Tool action counts",
          "frequency": "Weekly",
          "query_posthog": "SELECT event, COUNT(*) FROM events WHERE event LIKE 'Tool_%_Click' GROUP BY event",
          "query_supabase": "SELECT action_type, COUNT(*) FROM analytics.user_tool_actions GROUP BY action_type",
          "expected": "Counts match per action type"
        }
      ]
    }
  },
  "scaling_considerations": {
    "current_scale": "< 10,000 users, < 100,000 events/month",
    "data_warehouse_sync_cost": "Minimal - incremental syncs are efficient",
    "query_performance": "Fast - both systems optimized for analytics queries",
    "future_scale": {
      "100k_users": {
        "data_warehouse_sync": "Still efficient with incremental sync",
        "recommendation": "Consider increasing sync frequency to every 30 minutes"
      },
      "1M_users": {
        "data_warehouse_sync": "May need partitioning on large tables",
        "recommendation": "Use PostHog's materialized columns feature for common queries"
      }
    }
  },
  "disaster_recovery": {
    "posthog_outage": {
      "impact": "Event tracking fails, but Supabase tracking continues",
      "mitigation": "Analytics data still captured in Supabase, can backfill PostHog later",
      "recovery_time": "Automatic when PostHog comes back online"
    },
    "supabase_outage": {
      "impact": "Database tracking fails, but PostHog events continue",
      "mitigation": "High-level metrics still available in PostHog dashboards",
      "recovery_time": "Automatic when Supabase comes back online"
    },
    "data_warehouse_sync_failure": {
      "impact": "PostHog dashboards show stale Supabase data",
      "mitigation": "PostHog events still real-time, database data resumes on next sync",
      "recovery_time": "Next scheduled sync (hourly)"
    },
    "dual_tracking_benefit": "Redundancy ensures at least one system captures every event"
  },
  "cost_analysis": {
    "posthog_costs": {
      "free_tier": "1M events/month",
      "current_usage": "~50k events/month",
      "projection": "Well within free tier for next 6-12 months"
    },
    "supabase_costs": {
      "database_storage": "< 100MB (analytics tables)",
      "data_transfer": "Minimal (only Data Warehouse sync reads)",
      "free_tier": "500MB database, 2GB data transfer",
      "projection": "Free tier sufficient for 12+ months"
    },
    "data_warehouse_sync_costs": {
      "computation": "Included in PostHog free tier",
      "data_transfer": "Supabase â†’ PostHog read queries (minimal)",
      "estimated_monthly": "$0 (within free tiers)"
    },
    "total_monthly_cost": "$0 (within free tiers for both services)"
  }
}

