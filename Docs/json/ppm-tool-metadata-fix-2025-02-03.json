{
  "schema_version": "1.0.0",
  "last_updated": "2025-02-03T00:00:00Z",
  "type": "FIX",
  "metadata": {
    "project": "Panoramic Solutions Website",
    "maintainer": "Parker Gawne",
    "issue": "LinkedIn and social media link previews showing homepage metadata instead of PPM Tool metadata",
    "mcp_compatible": true
  },
  "issue_description": {
    "problem": "When sharing panoramic-solutions.com/ppm-tool or panoramic-solutions-staging.vercel.app/ppm-tool on LinkedIn, the link preview displayed homepage information instead of PPM Tool Finder information",
    "symptoms": [
      "Link preview shows 'Panoramic Solutions | SaaS Architecture & Digital Transformation' title",
      "Description shows homepage content instead of PPM Tool content",
      "OG image shows generic homepage image instead of PPM_Tool_Finder.png",
      "Issue occurs on both production and staging domains"
    ],
    "root_causes": [
      "Missing layout.tsx file in src/app/ppm-tool/ directory",
      "No page-specific Open Graph metadata defined for /ppm-tool route",
      "Client component (page.tsx) cannot export metadata in Next.js 15",
      "Root layout had hardcoded metadataBase URL that didn't adapt to staging/production domains"
    ]
  },
  "solution": {
    "approach": "Created dynamic metadata generation in both root and child layouts using Next.js 15 generateMetadata function with request header detection",
    "files_modified": [
      {
        "file": "src/app/layout.tsx",
        "changes": [
          "Added headers import from next/headers",
          "Created getBaseUrl() helper function that reads request headers",
          "Converted generateMetadata to async function",
          "Made metadataBase dynamic based on request domain",
          "Detects domain at request time instead of build time"
        ],
        "reason": "Root layout metadataBase needs to be dynamic to work correctly for child routes on different domains"
      },
      {
        "file": "src/app/ppm-tool/layout.tsx",
        "changes": [
          "Created new layout.tsx file for PPM Tool route",
          "Added headers import from next/headers",
          "Created getBaseUrl() helper function",
          "Implemented async generateMetadata function",
          "Set PPM Tool-specific Open Graph metadata",
          "Dynamic URL generation for canonical, og:url, og:image",
          "Twitter Card metadata included",
          "Proper SEO configuration with title, description, keywords"
        ],
        "reason": "Child layout provides PPM Tool-specific metadata with correct URLs for both staging and production"
      }
    ],
    "files_created": [
      "src/app/ppm-tool/layout.tsx"
    ]
  },
  "technical_details": {
    "metadata_generation": {
      "type": "Dynamic (Request Time)",
      "method": "generateMetadata async function",
      "url_detection": "headers() API from next/headers",
      "fallback_chain": [
        "1. NEXT_PUBLIC_SITE_URL environment variable",
        "2. Request headers (host + x-forwarded-proto)",
        "3. VERCEL_URL environment variable",
        "4. Default to https://panoramic-solutions.com"
      ]
    },
    "open_graph_tags": {
      "og:type": "website",
      "og:locale": "en_US",
      "og:url": "Dynamic based on request domain + /ppm-tool",
      "og:title": "PPM Tool Finder | Find Your Perfect Project Portfolio Management Tool",
      "og:description": "Discover the perfect Project Portfolio Management (PPM) tool for your organization. Our intelligent assessment analyzes your specific needs and provides personalized tool recommendations in minutes.",
      "og:site_name": "Panoramic Solutions",
      "og:image": "Dynamic based on request domain + /images/PPM_Tool_Finder.png",
      "og:image:width": "1200",
      "og:image:height": "630",
      "og:image:alt": "PPM Tool Finder - Find Your Perfect Project Portfolio Management Tool"
    },
    "twitter_card_tags": {
      "twitter:card": "summary_large_image",
      "twitter:title": "PPM Tool Finder | Find Your Perfect Project Portfolio Management Tool",
      "twitter:description": "Discover the perfect Project Portfolio Management (PPM) tool for your organization. Our intelligent assessment analyzes your specific needs and provides personalized tool recommendations in minutes.",
      "twitter:image": "Dynamic based on request domain + /images/PPM_Tool_Finder.png",
      "twitter:creator": "@panoramicsol"
    },
    "seo_tags": {
      "title": "PPM Tool Finder | Find Your Perfect Project Portfolio Management Tool",
      "description": "Discover the perfect Project Portfolio Management (PPM) tool for your organization. Our intelligent assessment analyzes your specific needs and provides personalized tool recommendations in minutes.",
      "keywords": "PPM Tool Finder, Project Portfolio Management, PPM Software, Project Management Tools, Portfolio Management Software, Tool Assessment",
      "canonical": "Dynamic based on request domain + /ppm-tool",
      "robots_index": true,
      "robots_follow": true
    }
  },
  "how_it_works": {
    "request_flow": [
      "1. Social media crawler (LinkedIn, Facebook, Twitter) requests /ppm-tool page",
      "2. Next.js server calls generateMetadata() in root layout",
      "3. getBaseUrl() reads request headers to detect domain (staging or production)",
      "4. Root layout sets dynamic metadataBase",
      "5. Next.js calls generateMetadata() in /ppm-tool/layout.tsx",
      "6. Child layout generates PPM Tool-specific metadata with correct domain",
      "7. Next.js renders HTML with proper Open Graph and Twitter Card meta tags",
      "8. Social media crawler parses meta tags and generates link preview"
    ],
    "domain_detection": {
      "staging": "Detects 'panoramic-solutions-staging.vercel.app' from host header",
      "production": "Detects 'panoramic-solutions.com' from host header",
      "preview_deployments": "Detects Vercel preview URL from host header",
      "localhost": "Falls back to localhost:3000 or environment variables"
    }
  },
  "testing_steps": {
    "after_deployment": [
      {
        "step": 1,
        "action": "Clear LinkedIn cache",
        "tool": "LinkedIn Post Inspector",
        "url": "https://www.linkedin.com/post-inspector/",
        "instructions": "Enter staging URL (https://panoramic-solutions-staging.vercel.app/ppm-tool) and click 'Inspect'"
      },
      {
        "step": 2,
        "action": "Clear Facebook cache",
        "tool": "Facebook Sharing Debugger",
        "url": "https://developers.facebook.com/tools/debug/",
        "instructions": "Enter URL and click 'Scrape Again'"
      },
      {
        "step": 3,
        "action": "Verify Twitter Card",
        "tool": "Twitter Card Validator",
        "url": "https://cards-dev.twitter.com/validator",
        "instructions": "Enter URL to preview Twitter card"
      },
      {
        "step": 4,
        "action": "Test link sharing",
        "platforms": ["LinkedIn", "Slack", "Discord", "Twitter", "Facebook"],
        "expected_result": "Link preview shows PPM Tool Finder title, description, and image"
      },
      {
        "step": 5,
        "action": "Verify on production",
        "url": "https://panoramic-solutions.com/ppm-tool",
        "instructions": "Repeat cache clearing and testing on production domain after deployment"
      }
    ],
    "manual_verification": [
      {
        "method": "View Page Source",
        "instructions": "Visit /ppm-tool page, right-click > View Page Source, search for 'og:title' and verify it shows PPM Tool Finder"
      },
      {
        "method": "Browser DevTools",
        "instructions": "Open DevTools > Elements tab > <head> section, verify meta tags have correct og:url with staging/production domain"
      },
      {
        "method": "curl Test",
        "command": "curl -I https://panoramic-solutions-staging.vercel.app/ppm-tool",
        "verify": "Check HTTP headers and ensure page loads successfully"
      }
    ]
  },
  "expected_results": {
    "staging": {
      "url": "https://panoramic-solutions-staging.vercel.app/ppm-tool",
      "og_url": "https://panoramic-solutions-staging.vercel.app/ppm-tool",
      "og_image": "https://panoramic-solutions-staging.vercel.app/images/PPM_Tool_Finder.png",
      "canonical": "https://panoramic-solutions-staging.vercel.app/ppm-tool",
      "title": "PPM Tool Finder | Find Your Perfect Project Portfolio Management Tool"
    },
    "production": {
      "url": "https://panoramic-solutions.com/ppm-tool",
      "og_url": "https://panoramic-solutions.com/ppm-tool",
      "og_image": "https://panoramic-solutions.com/images/PPM_Tool_Finder.png",
      "canonical": "https://panoramic-solutions.com/ppm-tool",
      "title": "PPM Tool Finder | Find Your Perfect Project Portfolio Management Tool"
    },
    "link_preview": {
      "title": "PPM Tool Finder | Find Your Perfect Project Portfolio Management Tool",
      "description": "Discover the perfect Project Portfolio Management (PPM) tool for your organization. Our intelligent assessment analyzes your specific needs and provides personalized tool recommendations in minutes.",
      "image": "PPM_Tool_Finder.png (1200x630)",
      "domain": "panoramic-solutions.com or panoramic-solutions-staging.vercel.app (depending on environment)"
    }
  },
  "build_verification": {
    "build_command": "npm run build",
    "build_status": "Success",
    "route_type": "Static (â—‹)",
    "no_errors": true,
    "no_warnings": true,
    "bundle_size": "172 kB (PPM Tool page)",
    "first_load_js": "437 kB"
  },
  "environment_variables": {
    "required": [],
    "optional": [
      {
        "name": "NEXT_PUBLIC_SITE_URL",
        "description": "Override URL detection (highest priority)",
        "example": "https://panoramic-solutions-staging.vercel.app",
        "when_to_use": "If you want to explicitly set the domain instead of auto-detection"
      },
      {
        "name": "VERCEL_URL",
        "description": "Automatically set by Vercel (fallback)",
        "set_by": "Vercel platform",
        "when_to_use": "Automatic - no action needed"
      }
    ]
  },
  "potential_issues": {
    "cache_not_cleared": {
      "symptom": "Link preview still shows old homepage metadata after deployment",
      "solution": "Use LinkedIn Post Inspector and Facebook Sharing Debugger to force re-scrape"
    },
    "wrong_image_displayed": {
      "symptom": "Link preview shows wrong image or no image",
      "solution": "Verify /images/PPM_Tool_Finder.png exists and is accessible at the correct URL"
    },
    "localhost_testing": {
      "symptom": "Social media crawlers can't access localhost URLs",
      "solution": "Use ngrok or deploy to staging to test social media link previews"
    },
    "environment_variable_conflict": {
      "symptom": "Wrong domain shown in metadata",
      "solution": "Check NEXT_PUBLIC_SITE_URL is not set to wrong domain in Vercel environment variables"
    }
  },
  "next_steps": [
    "Deploy to staging",
    "Clear LinkedIn cache using Post Inspector",
    "Test link sharing on staging",
    "Deploy to production",
    "Clear LinkedIn cache for production URL",
    "Test link sharing on production"
  ],
  "references": {
    "nextjs_metadata_docs": "https://nextjs.org/docs/app/api-reference/functions/generate-metadata",
    "nextjs_headers_docs": "https://nextjs.org/docs/app/api-reference/functions/headers",
    "open_graph_protocol": "https://ogp.me/",
    "twitter_cards": "https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/abouts-cards",
    "linkedin_post_inspector": "https://www.linkedin.com/post-inspector/",
    "facebook_sharing_debugger": "https://developers.facebook.com/tools/debug/"
  }
}

